<div class="well well-sm">
  <h4>{{ vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_Title) }}</h4>
  <div class="panel-content">
    <div class="form-group setting-group"
         ng-if="!vm.syncEnabled && vm.utilitySvc.isMobilePlatform(vm.appHelperSvc.platformName)">
      <p class="description text-center"
         ng-bind-html="vm.platformSvc.getI18nString(vm.strings.settings_NotAvailable_Message)">
      </p>
    </div>
    <div ng-show="vm.syncEnabled || !vm.utilitySvc.isMobilePlatform(vm.appHelperSvc.platformName)">
      <div class="form-group setting-group">
        <label>{{ vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_Backup_Label) }}</label>
        <p class="description" ng-if="!vm.syncEnabled">{{
        vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_BackupLocal_Description) }}</p>
        <p class="description" ng-if="vm.syncEnabled">{{
        vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_BackupSynced_Description) }}</p>
        <div class="buttons animate-fade-in" ng-hide="vm.backupCompletedMessage">
          <button class="btn btn-default" ng-disabled="vm.savingBackup" ng-class="{ 'working': vm.savingBackup }"
                  ng-click="vm.utilitySvc.handleEvent(vm.downloadBackup)" ng-disabled="vm.savingBackup">
            <span class="spinner-border spinner-border-sm" ng-show="vm.savingBackup" role="status"
                  aria-hidden="true"></span>
            <span ng-show="vm.savingBackup">{{
            vm.platformSvc.getI18nString(vm.strings.button_Saving_Label) }}
            </span>
            <span ng-hide="vm.savingBackup">{{
            vm.platformSvc.getI18nString(vm.strings.button_Backup_Label) }}</span>
          </button>
        </div>
        <div class="confirm animate-fade-in" ng-show="vm.backupCompletedMessage">
          <p>{{ vm.backupCompletedMessage }}</p>
          <p class="text-center">
            <a id="backupLink"></a>
          </p>
          <div class="buttons">
            <button class="btn btn-default btn-done" ng-click="vm.backupCompletedMessage = null">
              {{ vm.platformSvc.getI18nString(vm.strings.button_Done_Label) }}
            </button>
          </div>
        </div>
      </div>
      <div class="form-group setting-group">
        <label>{{ vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_Restore_Label) }}</label>
        <p class="description" ng-if="!vm.syncEnabled">{{
        vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_RestoreLocal_Description) }}</p>
        <p class="description" ng-if="vm.syncEnabled">{{
        vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_RestoreSynced_Description) }}</p>
        <div class="buttons animate-fade-in"
             ng-hide="vm.displayRestoreForm || vm.displayRestoreConfirmation || vm.restoreCompletedMessage">
          <button class="btn btn-default" ng-click="vm.utilitySvc.handleEvent(vm.displayRestorePanel)">
            {{ vm.platformSvc.getI18nString(vm.strings.button_Restore_Label) }}
          </button>
        </div>
        <form id="restoreForm" name="vm.restoreForm" class="confirm animate-fade-in" ng-show="vm.displayRestoreForm"
              novalidate>
          <input type="file" name="files[]" id="backupFile" class="d-none" tabindex="-1" />
          <p ng-if="!vm.utilitySvc.isMobilePlatform(vm.appHelperSvc.platformName)">
            {{ vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_RestoreForm_Message) }}
          </p>
          <div>
            <label for="dataToRestore"
                   class="sr-only">{{ vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_RestoreForm_DataField_Label) }}
            </label>
            <div class="form-group" ng-class="{ 'has-error': vm.restoreForm.dataToRestore.$invalid }">
              <input type="hidden" name="dataToRestore" ng-model="vm.dataToRestore"></input>
              <textarea ng-model="vm.dataToRestore" ng-model-options="{ updateOn: 'blur' }" class="form-control"
                        rows="3" ng-if="!vm.utilitySvc.isMobilePlatform(vm.appHelperSvc.platformName)"
                        ng-change="vm.resetFormValidity()" autocapitalize="off" autocomplete="off" autocorrect="off"
                        spellcheck="false"></textarea>
              <input type="text" ng-model="vm.backupFileName" class="form-control" readonly
                     placeholder="{{ vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_RestoreForm_BackupFile_Description) }}â€¦"
                     ng-if="vm.utilitySvc.isMobilePlatform(vm.appHelperSvc.platformName)"></input>
              <div class="validation" ng-if="vm.restoreForm.dataToRestore.$invalid">
                <span ng-if="vm.restoreForm.dataToRestore.$error.InvalidData">
                  {{ vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_RestoreForm_Invalid_Label) }}
                </span>
              </div>
              <span class="spinner-border spinner-border-sm" ng-show="vm.validatingRestoreData" role="status"
                    aria-hidden="true"></span>
            </div>
            <div class="buttons" ng-if="vm.utilitySvc.isMobilePlatform(vm.appHelperSvc.platformName)">
              <button class="btn btn-default" ng-click="vm.utilitySvc.handleEvent(vm.selectBackupFile)">
                {{ vm.platformSvc.getI18nString(vm.strings.button_SelectBackupFile_Label) }}
              </button>
            </div>
          </div>
          <div class="buttons">
            <button class="btn btn-default" ng-disabled="!vm.dataToRestore || vm.restoreForm.dataToRestore.$invalid"
                    ng-click="vm.utilitySvc.handleEvent(vm.restore)">
              {{ vm.platformSvc.getI18nString(vm.strings.button_RestoreData_Label) }}
            </button>
            <button type="reset" class="btn btn-default" ng-click="vm.displayRestoreForm = false">
              {{ vm.platformSvc.getI18nString(vm.strings.button_Cancel_Label) }}
            </button>
          </div>
        </form>
        <div class="confirm animate-fade-in" ng-show="vm.displayRestoreConfirmation">
          <div ng-if="vm.syncEnabled && vm.utilitySvc.isMobilePlatform(vm.appHelperSvc.platformName)"
               ng-bind-html="vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_ConfirmRestore_Sync_Message_Android)">
          </div>
          <div ng-if="vm.syncEnabled && !vm.utilitySvc.isMobilePlatform(vm.appHelperSvc.platformName)"
               ng-bind-html="vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_ConfirmRestore_Sync_Message_Desktop)">
          </div>
          <div ng-if="!vm.syncEnabled"
               ng-bind-html="vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_ConfirmRestore_NoSync_Message)">
          </div>
          <div class="buttons">
            <button class="btn btn-default btn-confirm-restore" ng-click="vm.utilitySvc.handleEvent(vm.confirmRestore)">
              {{ vm.platformSvc.getI18nString(vm.strings.button_Confirm_Label) }}
            </button>
            <button type="reset" class="btn btn-default" ng-click="vm.displayRestoreConfirmation = false">
              {{ vm.platformSvc.getI18nString(vm.strings.button_Deny_Label) }}
            </button>
          </div>
        </div>
        <div class="confirm animate-fade-in" ng-show="vm.restoreCompletedMessage">
          <p>{{ vm.restoreCompletedMessage }}</p>
          <div class="buttons">
            <button class="btn btn-default btn-done" ng-click="vm.restoreCompletedMessage = null">
              {{ vm.platformSvc.getI18nString(vm.strings.button_Done_Label) }}
            </button>
          </div>
        </div>
      </div>
      <div class="form-group setting-group" ng-if="!vm.utilitySvc.isMobilePlatform(vm.appHelperSvc.platformName)">
        <label>{{ vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_Revert_Label) }}</label>
        <p class="description">
          {{ vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_Revert_Description) }}</p>
        <div class="buttons animate-fade-in"
             ng-hide="vm.displayRevertConfirmation || vm.revertCompleted || vm.revertUnavailable">
          <button class="btn btn-default" ng-click="vm.utilitySvc.handleEvent(vm.displayRevertPanel)">
            {{ vm.platformSvc.getI18nString(vm.strings.button_Revert_Label) }}
          </button>
        </div>
        <div class="confirm animate-fade-in" ng-show="vm.displayRevertConfirmation">
          <div ng-bind-html="vm.revertConfirmationMessage"></div>
          <div class="buttons">
            <button class="btn btn-default btn-confirm-restore" ng-click="vm.utilitySvc.handleEvent(vm.confirmRevert)">
              {{ vm.platformSvc.getI18nString(vm.strings.button_Confirm_Label) }}
            </button>
            <button type="reset" class="btn btn-default" ng-click="vm.utilitySvc.handleEvent(vm.closeRevertPanel)">
              {{ vm.platformSvc.getI18nString(vm.strings.button_Deny_Label) }}
            </button>
          </div>
        </div>
        <div class="confirm animate-fade-in" ng-show="vm.revertCompleted || vm.revertUnavailable">
          <div></div>
          <p ng-if="vm.revertCompleted">
            {{ vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_Revert_Completed_Label) }}</p>
          <p ng-if="vm.revertUnavailable">
            {{ vm.platformSvc.getI18nString(vm.strings.settings_BackupRestore_Revert_Unavailable_Label) }}</p>
          <div class="buttons">
            <button class="btn btn-default btn-done" ng-click="vm.utilitySvc.handleEvent(vm.closeRevertPanel)">
              {{ vm.platformSvc.getI18nString(vm.strings.button_Done_Label) }}
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
